import datetime
from BaseDeDonnee import BaseDeDonnee

##/!\
##ATTENTION : Nous sommes limites a 60 requetes par minutes. Si plusieures personnes utilisent ce programme avec la meme cle API, il risque d'y avoir des problemes.

##NOUS VOUS FOURNISSONS NOTRE CLE API OPENSTREETWEATHER. SI VOUS SOUHAITEZ UTILISER LA VOTRE, CHANGEZ LA LIGNE SUIVANTE :
cleAPI = "2fd760807b08fc97be68c52954281198"

##IL VOUS A NORMALEMENT ETE FOURNI LE FICHIER "meteoBDD.db". SI VOUS SOUHAITEZ UTILISE UN AUTRE FICHIER OU EN CREER UN NOUVEAU, CHANGEZ LA LIGNE SUIVANTE :
fichierBDD = "meteoBDD.db"
#Dans le cas où vous mettez un nouveau nom, le programme creera le fichier lui-meme. N'oubliez pas l'extension ".db".

##NOUS VOUS AVONS EGALEMMENT FOUNI LA LISTE DES VILLES A ETUDIER. VOUS POUVEZ METTRE LE VOTRE EN CHANGEANT LA LIGNE SUIVANT :
fichierVilles = "villes.txt"
#Si vous creez votre propre fichier villes, la première ligne doit être un "0". C'est une valeur de sauvegarde qui servira au programme à reprendre là où il en etait la prochaine fois.


BDD = BaseDeDonnee(fichierVilles, fichierBDD, cleAPI)
BDD.initialiser() #Cree le fichier BDD s'il n'existe pas. 
                  #Recupere les villes du fichier villes. 
                  #Retrouve a quelle ville il s'en etait arrete (premiere ligne du fichier villes)
                  #redefinie la taille de la liste des villes (on peut ainsi en rajouter)


while 1 :
    if (BDD.tempsDernieresRequetes == None) or (datetime.datetime.now() - BDD.tempsDernieresRequetes).seconds >= 60 :
        BDD.enregistrer()
    
